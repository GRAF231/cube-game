# Механики игры Тетрис-блоки

## Основные механики

### Генерация и размещение фигур
1. **Типы фигур**: Игра использует 8 различных типов фигур (ShapeType), определенных в файле `src/game/types.ts`:
   - SINGLE: одиночный блок
   - LINE_2: линия из 2 блоков
   - LINE_3: линия из 3 блоков
   - L_SHAPE: Г-образная фигура
   - SQUARE: квадрат из 4 блоков
   - T_SHAPE: Т-образная фигура
   - CROSS: крестообразная фигура
   - Z_SHAPE: Z-образная фигура

2. **Создание фигур**: Фигуры генерируются классом `ShapeGenerator`. Каждая фигура имеет случайный цвет из фиксированного набора ярких цветов и определенную форму, заданную массивом координат блоков.

3. **Выбор фигуры**: Игроку доступны 3 фигуры на выбор. После использования фигуры, она заменяется новой.

4. **Размещение фигуры**: Игрок может разместить фигуру на игровом поле, если для неё есть место. При перетаскивании фигуры над полем отображается "призрак" фигуры, который показывает, где она будет размещена.

5. **Проверка возможности размещения**: Перед размещением фигуры система проверяет, не выходит ли она за границы поля и не перекрывает ли уже существующие блоки.

### Очистка линий

1. **Проверка заполненных линий**: После размещения фигуры система проверяет, есть ли полностью заполненные строки или столбцы.

2. **Процесс очистки**: Если строка или столбец полностью заполнены, все блоки в них очищаются с анимацией.

3. **Предварительное отображение**: При перемещении фигуры над полем система показывает, какие линии будут очищены, если фигура будет размещена в текущей позиции.

4. **Обновление состояния**: После очистки линий обновляется внутреннее состояние игры и визуальное отображение.

## Система подсчета очков

1. **Базовые очки**: За каждую очищенную ячейку игрок получает 10 базовых очков.

2. **Бонус за область**: Если очищено несколько линий одновременно (и строки, и столбцы), применяется множитель 1.5.

3. **Система комбо**: При последовательной очистке линий без пропусков активируется множитель комбо. Формула: `1 + (комбо * 0.1)`.

4. **Итоговые очки**: Общая формула: `базовые_очки * бонус_за_область * бонус_за_комбо`.

5. **Отображение очков**: При получении очков они анимируются в центре очищенной области.

## Система анимаций

Игра использует множество анимаций для обеспечения отзывчивого и привлекательного игрового процесса:

1. **Анимация размещения фигуры**: При размещении фигуры на поле блоки появляются с анимацией.

2. **Анимация очистки линий**: При очистке строк или столбцов блоки исчезают с эффектами вспышки и частиц.

3. **Анимация очков**: При получении очков их значение анимированно появляется и исчезает над игровым полем.

4. **Анимация призрака фигуры**: При перемещении фигуры над полем отображается "призрак" с цветовой индикацией возможности размещения.

5. **Подсветка линий для очистки**: Линии, которые будут очищены, подсвечиваются с эффектом пульсации.

6. **3D-эффекты для блоков**: Каждый блок на поле имеет визуальные эффекты (блики сверху и тени снизу), создающие объемное восприятие.

## Система фигур

1. **Структура фигуры**: Каждая фигура представлена объектом типа `Shape` с полями:
   - `type`: тип фигуры (из перечисления ShapeType)
   - `blocks`: массив координат блоков, составляющих фигуру
   - `color`: цвет фигуры в HEX-формате
   - `previewPosition`: позиция на панели превью (если есть)

2. **Генерация фигур**: Новые фигуры генерируются при:
   - Начале игры
   - Когда все 3 слота используются
   - После успешного просмотра рекламы (бонусные одиночные блоки)

3. **Управление доступными фигурами**: Система отслеживает, какие фигуры доступны игроку и какая выбрана в данный момент.

4. **Бонусные фигуры**: После завершения игры игрок может получить 3 бонусных одиночных блока за просмотр рекламы.

## Функция проверки окончания игры

1. **Условие окончания**: Игра считается оконченной, когда ни одну из доступных фигур невозможно разместить на поле.

2. **Проверка**: После каждого размещения фигуры система проверяет возможность размещения оставшихся фигур.

3. **Перебор позиций**: Для каждой фигуры система перебирает все возможные позиции на поле (64 позиции для сетки 8x8).

4. **Действия при окончании**: При окончании игры показывается модальное окно с итоговым счетом и опциями:
   - "Заново" - начать новую игру
   - "Бонус" - получить бонусные фигуры за просмотр рекламы
   - "В меню" - перейти в главное меню

## Бонусы за просмотр рекламы

1. **Механика бонуса**: После завершения игры игрок может получить бонусные фигуры (3 одиночных блока) за просмотр rewarded-рекламы.

2. **Интеграция с Яндекс.SDK**: Для показа рекламы используется Яндекс.SDK через `GameSceneYandexHandler`.

3. **Начисление бонуса**: После успешного просмотра рекламы вызывается метод `addBonusShapes(3)` в `GameManager`, который:
   - Добавляет до 3 одиночных блоков в доступные слоты
   - Сбрасывает статус окончания игры
   - Обновляет UI с анимацией появления новых фигур