# Структура проекта Тетрис-блоки

## Общая структура проекта

> **Обновлено 12.04.2025**: Проект был реструктурирован для улучшения организации кода.

Проект построен с использованием Create React App и имеет следующую основную структуру директорий:

```
/
├── public/                   # Статические файлы
├── src/                      # Исходный код
│   ├── components/           # React компоненты
│   │   └── PhaserGame.tsx    # Корневой компонент Phaser
│   ├── game/                 # Игровая логика на Phaser
│   │   ├── core/             # Ядро игры
│   │   │   ├── logic/        # Чистая игровая логика
│   │   │   │   ├── GameLogic.ts
│   │   │   │   ├── ScoreSystem.ts
│   │   │   │   └── ShapeGenerator.ts
│   │   │   ├── state/        # Управление состоянием игры
│   │   │   │   ├── GameState.ts
│   │   │   │   └── GameManager.ts
│   │   │   └── types/        # Типы и интерфейсы для ядра
│   │   │       ├── game-types.ts
│   │   │       ├── shape-types.ts
│   │   │       └── state-types.ts
│   │   ├── ui/               # Все UI-компоненты
│   │   │   ├── components/   # Общие UI-компоненты
│   │   │   ├── managers/     # UI-менеджеры
│   │   │   │   ├── score/
│   │   │   │   ├── preview/
│   │   │   │   └── background/
│   │   │   ├── animation/    # Анимации
│   │   │   └── effects/      # Визуальные эффекты
│   │   ├── input/            # Обработка пользовательского ввода
│   │   ├── integration/      # Интеграция с внешними системами
│   │   ├── scenes/           # Сцены Phaser
│   │   └── config.ts         # Конфигурация игры
│   └── utils/                # Общие утилиты
│       └── StateUtils.ts     # Утилиты для работы с состоянием
└── ...                       # Конфигурационные файлы
```

## Ключевые директории и файлы

### Директория `src/`

Основная директория с исходным кодом, содержащая как React, так и Phaser части проекта.

#### `src/components/`

React-компоненты, используемые в проекте:
- `PhaserGame.tsx`: Компонент, монтирующий Phaser-игру в DOM

#### `src/game/`

Содержит всю игровую логику и компоненты Phaser:

##### `src/game/core/`

Ядро игры с разделением на функциональные области:

- `core/logic/`: Чистая игровая логика
  - `GameLogic.ts`: Основные правила игры (размещение фигур, очистка линий)
  - `ScoreSystem.ts`: Система подсчета очков
  - `ShapeGenerator.ts`: Класс для создания и генерации игровых фигур

- `core/state/`: Управление состоянием игры
  - `GameState.ts`: Хранение и управление состоянием с иммутабельным подходом
  - `GameManager.ts`: Координация всех компонентов игры

- `core/types/`: Определения типов и интерфейсов
  - `game-types.ts`: Базовые игровые типы (ячейки, позиции)
  - `shape-types.ts`: Типы для фигур
  - `state-types.ts`: Интерфейс состояния игры

##### `src/game/ui/`

Компоненты пользовательского интерфейса:

- `components/`: Базовые UI-компоненты (GridComponent)
- `managers/`: Менеджеры UI (ScoreDisplay, ShapePreview)
- `animation/`: Анимации (Animator)
- `effects/`: Визуальные эффекты (Background)

##### `src/game/input/`

Обработка пользовательского ввода:

- `InputHandler.ts`: Базовый обработчик ввода
- `GridHandler.ts`: Специализированный обработчик для сетки

##### `src/game/integration/`

Интеграции с внешними системами:

- `yandex/YandexHandler.ts`: Интеграция с Яндекс.Играми

#### `src/utils/`

Общие утилиты, используемые в проекте:

- `StateUtils.ts`: Утилиты для иммутабельной работы с состоянием
  - Методы для безопасного обновления объектов и массивов
  - Функции для работы с игровой сеткой без мутации данных

## Преимущества новой структуры

Реструктуризация проекта позволила достичь следующих улучшений:

1. **Четкое разделение ответственности**
   - Каждый компонент имеет строго определенную область ответственности
   - Исключено дублирование логики благодаря композиции

2. **Улучшенная навигация по проекту**
   - Логическое группирование файлов по функциональным областям
   - Единые точки входа через индексные файлы

3. **Иммутабельный подход к управлению состоянием**
   - Предсказуемое поведение без неожиданных побочных эффектов
   - Улучшенная отладка и тестируемость

4. **Улучшенная масштабируемость**
   - Легко добавлять новые компоненты в соответствующие директории
   - Четкие интерфейсы для взаимодействия между компонентами
- `GameManager.ts`: Управление игровым процессом, состоянием и логикой

#### `src/game/components/`

Компоненты Phaser, используемые в игре:
- `GridComponent.ts`: Отвечает за визуальное представление игровой сетки
- `ScoreDisplay.ts`: (Устаревший) Компонент для отображения счета
- `ShapePreview.ts`: (Устаревший) Компонент для предпросмотра фигур

#### `src/game/core/`

Содержит классы игровой логики, разработанные в процессе рефакторинга:
- `GameLogic.ts`: Чистые функции для игровой логики
- `ScoreSystem.ts`: Логика подсчета очков и комбо
- `GameState.ts`: Класс для управления состоянием игры
- `GameManager.ts`: Альтернативная реализация GameManager как фасада

#### `src/game/scenes/`

Сцены Phaser, используемые в игре:
- `BaseScene.ts`: Базовый класс для всех сцен с общими методами
- `PreloadScene.ts`: Сцена предзагрузки и инициализации SDK
- `MenuScene.ts`: Сцена главного меню
- `GameScene.ts`: Основная игровая сцена
- `LeaderboardScene.ts`: Сцена таблицы лидеров

#### `src/game/scenes/animation/`

Содержит компоненты для управления анимациями:
- `GameSceneAnimator.ts`: Логика для различных игровых анимаций

#### `src/game/scenes/background/`

Управление фоновыми элементами и эффектами:
- `GameSceneBackground.ts`: Создание и анимация фоновых элементов

#### `src/game/scenes/grid/`

Обработка взаимодействий с игровой сеткой:
- `GameSceneGridHandler.ts`: Логика размещения фигур на сетке

#### `src/game/scenes/input/`

Компоненты для обработки пользовательского ввода:
- `GameSceneInputHandler.ts`: Обработка drag & drop и другого ввода

#### `src/game/scenes/sdk/`

Интеграция с внешними SDK:
- `GameSceneYandexHandler.ts`: Взаимодействие с Yandex Games SDK

#### `src/game/scenes/ui/`

Управление пользовательским интерфейсом:
- `GameSceneUIManager.ts`: Координация всех UI-элементов
- `background/GameSceneUIBackground.ts`: Управление фоновыми элементами UI
- `preview/GameSceneUIShapePreview.ts`: Предпросмотр игровых фигур
- `score/GameSceneUIScoreDisplay.ts`: Отображение счета и комбо

#### `src/types/`

Определения типов для внешних библиотек:
- `yandex-games.d.ts`: Типы для Yandex Games SDK

### Директория `public/`

Содержит статические файлы, доступные через веб-сервер:
- `index.html`: Основной HTML-файл
- `favicon.ico`: Иконка сайта
- Другие ресурсы (изображения, манифесты и т.д.)

## Архитектурные паттерны

### Композиция и разделение ответственности

В проекте применен подход разделения ответственности через выделение специализированных компонентов:

1. **Основная игровая сцена (GameScene)** координирует работу шести специализированных менеджеров:
   - **UIManager**: Управление визуальными элементами через подкомпоненты
   - **InputHandler**: Обработка пользовательского ввода
   - **Animator**: Управление анимациями
   - **YandexHandler**: Взаимодействие с Яндекс SDK
   - **Background**: Управление фоновыми эффектами
   - **GridHandler**: Обработка взаимодействий с сеткой

2. **GameManager** инкапсулирует всю игровую логику, отделяя её от визуального представления.

### Система событий

Игра использует систему событий для связи между компонентами, особенно между `GameManager` и основной сценой. События определены в интерфейсе `GameEvents` и включают:
- `onScoreUpdate`: Обновление счета
- `onGameOver`: Завершение игры
- `onComboUpdate`: Обновление комбо
- `onShapesUpdate`: Обновление доступных фигур
- `onPointsEarned`: Отображение полученных очков

## Заметки по улучшению структуры

На основе анализа текущего кода и выполненных улучшений можно отметить:

1. **Реорганизация UI-компонентов**: UI-компоненты были реорганизованы, функциональность выделена в специализированные подкомпоненты (GameSceneUIBackground, GameSceneUIScoreDisplay, GameSceneUIShapePreview), что улучшает поддерживаемость.

2. **Улучшенное разделение ответственности**: Добавление GameSceneGridHandler и GameSceneBackground позволило дальше разделить ответственность и сделать компоненты более специализированными.

3. **Устранение дублирования кода**: Проведен рефакторинг `GameManager`, который теперь использует компоненты из директории `core/` через композицию вместо дублирования логики.

4. **Иммутабельное управление состоянием**: Добавлен модуль `StateUtils` и обновлены компоненты для использования иммутабельного подхода, что устраняет побочные эффекты от случайных мутаций данных.

5. **Загрузка ресурсов**: `PreloadScene` по-прежнему не загружает игровые ресурсы (изображения, звуки), хотя это типичная задача для сцены предзагрузки.

6. **Дальнейшие улучшения**: Возможно внедрение следующих улучшений:
   - Реорганизация UI-компонентов с введением общего базового класса
   - Улучшение типизации и документации
   - Оптимизация производительности через профилирование