# Структура проекта Тетрис-блоки

## Общая структура проекта

Проект построен с использованием Create React App и имеет следующую основную структуру директорий:

```
/
├── public/                  # Статические файлы
├── src/                     # Исходный код
│   ├── components/          # React компоненты
│   ├── game/                # Игровая логика на Phaser
│   │   ├── components/      # Компоненты Phaser
│   │   ├── core/            # Базовая игровая логика
│   │   ├── scenes/          # Сцены Phaser
│   │   │   ├── animation/   # Классы для анимаций
│   │   │   ├── input/       # Обработчики ввода
│   │   │   ├── sdk/         # Интеграция с SDK
│   │   │   └── ui/          # UI-менеджеры
│   │   └── ...              # Другие файлы игровой логики
│   ├── types/               # Определения типов
│   └── ...                  # Другие файлы React-приложения
└── ...                      # Конфигурационные файлы
```

## Ключевые директории и файлы

### Директория `src/`

Основная директория с исходным кодом, содержащая как React, так и Phaser части проекта.

#### `src/components/`

React-компоненты, используемые в проекте:
- `PhaserGame.tsx`: Компонент, монтирующий Phaser-игру в DOM

#### `src/game/`

Содержит всю игровую логику и компоненты Phaser:

- `Game.ts`: Основной класс игры, инициализирующий Phaser
- `config.ts`: Конфигурация игры (размеры, цвета и т.д.)
- `types.ts`: Определение интерфейсов и типов для игры
- `ShapeGenerator.ts`: Класс для создания и генерации игровых фигур
- `GameManager.ts`: Управление игровым процессом, состоянием и логикой

#### `src/game/components/`

Компоненты Phaser, используемые в игре:
- `GridComponent.ts`: Отвечает за визуальное представление игровой сетки
- `ScoreDisplay.ts`: (Устаревший) Компонент для отображения счета
- `ShapePreview.ts`: (Устаревший) Компонент для предпросмотра фигур

#### `src/game/core/`

Содержит классы игровой логики, разработанные в процессе рефакторинга:
- `GameLogic.ts`: Чистые функции для игровой логики
- `ScoreSystem.ts`: Логика подсчета очков и комбо
- `GameState.ts`: Класс для управления состоянием игры
- `GameManager.ts`: Альтернативная реализация GameManager как фасада

#### `src/game/scenes/`

Сцены Phaser, используемые в игре:
- `BaseScene.ts`: Базовый класс для всех сцен
- `PreloadScene.ts`: Сцена предзагрузки и инициализации SDK
- `MenuScene.ts`: Сцена главного меню
- `GameSceneNew.ts` (используется как `GameScene`): Основная игровая сцена
- `LeaderboardScene.ts`: Сцена таблицы лидеров

#### `src/game/scenes/animation/`

Содержит компоненты для управления анимациями:
- `GameSceneAnimator.ts`: Логика для различных игровых анимаций

#### `src/game/scenes/input/`

Компоненты для обработки пользовательского ввода:
- `GameSceneInputHandler.ts`: Обработка drag & drop и другого ввода

#### `src/game/scenes/sdk/`

Интеграция с внешними SDK:
- `GameSceneYandexHandler.ts`: Взаимодействие с Yandex Games SDK

#### `src/game/scenes/ui/`

Управление пользовательским интерфейсом:
- `GameSceneUIManager.ts`: Создание и управление UI-элементами

#### `src/types/`

Определения типов для внешних библиотек:
- `yandex-games.d.ts`: Типы для Yandex Games SDK

### Директория `public/`

Содержит статические файлы, доступные через веб-сервер:
- `index.html`: Основной HTML-файл
- `favicon.ico`: Иконка сайта
- Другие ресурсы (изображения, манифесты и т.д.)

## Архитектурные паттерны

### Композиция и разделение ответственности

В проекте применен подход разделения ответственности через выделение специализированных компонентов:

1. **Основная игровая сцена (GameSceneNew)** координирует работу четырех специализированных менеджеров:
   - **UIManager**: Управление визуальными элементами
   - **InputHandler**: Обработка пользовательского ввода
   - **Animator**: Управление анимациями
   - **YandexHandler**: Взаимодействие с Яндекс SDK

2. **GameManager** инкапсулирует всю игровую логику, отделяя её от визуального представления.

### Система событий

Игра использует систему событий для связи между компонентами, особенно между `GameManager` и основной сценой. События определены в интерфейсе `GameEvents` и включают:
- `onScoreUpdate`: Обновление счета
- `onGameOver`: Завершение игры
- `onComboUpdate`: Обновление комбо
- `onShapesUpdate`: Обновление доступных фигур
- `onPointsEarned`: Отображение полученных очков

## Заметки по улучшению структуры

На основе анализа кода выявлены некоторые области для потенциального улучшения:

1. **Дублирование кода**: Существуют два `GameManager` (в `src/game/` и `src/game/core/`), что указывает на незавершенный рефакторинг.

2. **Устаревшие компоненты**: Классы `ShapePreview.ts` и `ScoreDisplay.ts` могут быть удалены, так как их функциональность теперь инкапсулирована в `GameSceneUIManager`.

3. **Дублирование логики**: Метод `calculateCenterPosition` и логика подсчета очков дублируются в разных файлах.

4. **Загрузка ресурсов**: `PreloadScene` не загружает игровые ресурсы (изображения, звуки), хотя это типичная задача для сцены предзагрузки.

5. **Управление состоянием**: Текущий `GameManager` напрямую мутирует состояние сетки, что может приводить к побочным эффектам. Рекомендуется создавать копию состояния перед модификацией (как это сделано в альтернативной версии).